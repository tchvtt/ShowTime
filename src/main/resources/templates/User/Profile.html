<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>ShowTime - Profile</title>
    <link th:href="@{/main.css}" rel="stylesheet" />
    <link rel="icon" href="/assets/favicon.png" type="image/x-icon">
    <script>
            let isEditing = false;

            function toggleEditMode() {
                const emailInput = document.getElementById('modal-email');
                const passwordInput = document.getElementById('modal-password');
                const editButton = document.getElementById('modal-editButton');
                const updateForm = document.getElementById('updateForm');

                if (!isEditing) {
                    emailInput.readOnly = false;
                    passwordInput.readOnly = false;
                    emailInput.style.pointerEvents = 'auto';
                    passwordInput.style.pointerEvents = 'auto';
                    editButton.textContent = 'Save';
                    isEditing = true;
                } else {
                    emailInput.readOnly = true;
                    passwordInput.readOnly = true;
                    emailInput.style.pointerEvents = 'none';
                    passwordInput.style.pointerEvents = 'none';
                    editButton.textContent = 'Edit';
                    isEditing = false;
                    updateForm.submit();
                }
            }

            function toggleModal() {
                const modal = document.getElementById('accountSettingsModal');
                modal.classList.toggle('hidden');
                modal.classList.toggle('opacity-0');  
                modal.classList.toggle('opacity-100');
                modal.classList.toggle('pointer-events-none');  
            }
        
            document.addEventListener('DOMContentLoaded', function() {
                document.getElementById('accountSettingsModal').addEventListener('click', function(event) {
                    if (event.target === this) {
                        toggleModal();
                    }
                });
            });
    </script>
</head>
<body class="bg-customGray font-sans text-white">
    <!-- Header -->
    <div th:replace="~{Components/Header :: header}"></div>

    <div class="flex flex-col items-center">
        <div class="w-full max-w-6xl mt-8 px-4 py-8 rounded-xl">

            <!-- Profile Title -->
            <h1 class="text-3xl font-bold mb-4 text-center text-customPink" th:text="'Profile of ' + ${user.username}"></h1>

            <!-- Div for buttons -->
            <div class="flex flex-row justify-center items-center my-16 gap-4">
                <!-- Button to Open Modal -->
                <button 
                    onclick="toggleModal()" 
                    class="bg-customPink px-4 py-2 rounded-full text-white hover:scale-105 transition-transform">
                    Account Settings
                </button>

                <!-- Logout Button -->
                <form th:action="@{/logout}" method="post">
                    <button type="submit" class="bg-red-600 px-4 py-2 rounded-full text-white hover:scale-105 transition-transform">
                        Logout
                    </button>
                </form>                
            </div>


            <!-- Modal -->
            <div id="accountSettingsModal" name="accountSettingsModal" class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center z-50 pointer-events-none transition-opacity duration-300">
                <div class="bg-customGray text-white rounded-lg p-6 w-96 shadow-lg">
                    <h2 class="text-xl font-bold mb-6 text-customPink text-center">Account Settings</h2>
                    <form id="updateForm" th:action="@{/profile/update}" method="post" class="flex flex-col space-y-4">
                        <!-- Username -->
                        <div>
                            <label for="modal-username" class="block text-customPink mb-1">Username</label>
                            <input id="modal-username" type="text" 
                                th:value="${user.username}" 
                                readonly 
                                class="bg-customLightGray p-2 rounded w-full text-white" />
                        </div>

                        <!-- Email -->
                        <div>
                            <label for="modal-email" class="block text-customPink mb-1">Email</label>
                            <input id="modal-email" type="email" name="email" 
                                th:value="${user.email}" 
                                readonly 
                                style="pointer-events: none;" 
                                class="bg-customLightGray p-2 rounded w-full text-white" />
                        </div>

                        <!-- Password -->
                        <div>
                            <label for="modal-password" class="block text-customPink mb-1">Password</label>
                            <input id="modal-password" type="password" name="password" 
                                th:value="${user.password}" 
                                readonly 
                                style="pointer-events: none;" 
                                class="bg-customLightGray p-2 rounded w-full text-white" />
                        </div>

                        <!-- Buttons -->
                        <div class="flex flex-row justify-center gap-8">
                            <button type="button" id="modal-editButton" 
                                    onclick="toggleEditMode()" 
                                    class="bg-customPink px-4 py-2 rounded text-white text-center hover:scale-105 transition-transform">
                                Edit
                            </button>
                            <button onclick="toggleModal()" 
                                    class="border border-customPink bg-customLightGray text-customPink px-4 py-2 rounded text-center hover:bg-customPink hover:text-customLightGray transition-all">
                                Close
                            </button>
                            <!--
                            <button type="submit" formaction="@{/profile/delete}" 
                                    class="bg-red-600 px-4 py-2 rounded text-white hover:scale-105 transition-transform">
                                Delete Account
                            </button>
                            -->
                        </div>
                    </form>

                    <!-- Close Modal Button -->
                     <!--
                    <button onclick="toggleModal()" 
                            class="mt-4 w-full border border-customPink bg-customLightGray text-customPink px-4 py-2 rounded text-center hover:bg-customPink hover:text-customLightGray transition-all">
                        Close
                    </button>
                    -->
                </div>
            </div>


            <!-- User's Media Lists -->
            <h2 class="text-2xl font-bold mb-4 text-customPink">Your Lists</h2>
            <div th:each="list : ${user.mediaLists}" class="mb-8">
                <h3 class="text-base mb-4 text-white" th:text="${list.name}"></h3>
                <div class="overflow-x-auto scrollable-div">
                    <div class="flex gap-6">
                        <div th:each="media : ${list.mediaList}" class="flex flex-col items-center w-36">
                            <a th:href="@{/media/{id}(id=${media.id})}">
                                <img th:src="@{${media.posterURL}}" alt="Poster of ${media.title}" class="w-36 h-48 object-cover rounded-lg shadow-md mb-2" />
                            </a>
                            <a th:href="@{/media/{id}(id=${media.id})}" 
                            th:text="${media.title}" 
                            class="movie-title text-center block text-white mb-2 transition-colors duration-300 ease-in-out hover:!text-customPink">
                                Movie Title
                            </a>
                        </div>
                    </div>
                </div>                
            </div>

            <!-- Ratings Section -->
            <h2 class="text-2xl font-bold mb-4 text-customPink">Your Ratings</h2>
            <ul class="space-y-4">
                <li th:each="rating : ${ratings}" class="bg-gray-800 p-4 rounded-lg shadow-lg">
                    <p>
                        <strong class="text-customPink">Media:</strong>
                        <a th:href="@{/media/{id}(id=${rating.media.id})}" th:text="${rating.media.title}" class="hover:underline text-customPink"></a>
                    </p>
                    <p>
                        <strong class="text-customPink">Rating:</strong>
                        <span th:text="${rating.rating}"></span>/5
                    </p>
                    <p>
                        <strong class="text-customPink">Comment:</strong>
                        <span th:text="${rating.comment}"></span>
                    </p>
                    <p class="text-sm text-gray-400">
                        <strong class="text-customPink">Posted on:</strong>
                        <span th:text="${rating.date}"></span>
                    </p>
                </li>
            </ul>

        </div>

        <!-- Scrollable-Div Script -->
        <script src="/assets/js/scrollable-div.js"></script>     

    </div>

    <!-- Footer -->
    <div th:replace="~{Components/Footer :: footer}"></div>
</body>
</html>
