<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>ShowTime - Profile</title>
    <link th:href="@{/main.css}" rel="stylesheet" />
    <link rel="icon" href="/assets/favicon.png" type="image/x-icon">
    <script>
        let isEditing = false;

        function toggleEditMode() {
            const emailInput = document.getElementById('email');
            const passwordInput = document.getElementById('password');
            const editButton = document.getElementById('editButton');
            const updateForm = document.getElementById('updateForm');

            if (!isEditing) {
                emailInput.readOnly = false;
                passwordInput.readOnly = false;
                emailInput.style.pointerEvents = 'auto';
                passwordInput.style.pointerEvents = 'auto';
                editButton.textContent = 'Save';
                isEditing = true;
            } else {
                emailInput.readOnly = true;
                passwordInput.readOnly = true;
                emailInput.style.pointerEvents = 'none';
                passwordInput.style.pointerEvents = 'none';
                editButton.textContent = 'Edit';
                isEditing = false;
                updateForm.submit();
            }
        }
    </script>
</head>
<body class="bg-customGray font-sans text-white">
    <!-- Header -->
    <div th:replace="~{Components/Header :: header}"></div>

    <div class="flex flex-col items-center">
        <div class="w-full max-w-6xl mt-8 px-4 py-8 rounded-xl">

            <!-- Profile Title -->
            <h1 class="text-3xl font-bold mb-4 text-center text-customPink" th:text="'Profile of ' + ${user.username}"></h1>

            <!-- User Info Section -->
            <form id="updateForm" th:action="@{/profile/update}" method="post" class="p-6 rounded-lg mb-8">
                <div class="flex justify-center items-center gap-12">
                    <!-- Username -->
                    <p class="flex items-center">
                        <strong class="text-customPink mr-2">Username:</strong>
                        <span th:text="${user.username}" class="text-white"></span>
                    </p>
            
                    <!-- Email -->
                    <p class="flex items-center">
                        <strong class="text-customPink mr-2">Email:</strong>
                        <input id="email" type="email" name="email" 
                               th:value="${user.email}" 
                               readonly
                               style="pointer-events: none;" 
                               class="bg-customLightGray text-white p-1 rounded w-40" />
                    </p>
            
                    <!-- Password -->
                    <p class="flex items-center">
                        <strong class="text-customPink mr-2">Password:</strong>
                        <input id="password" type="password" name="password" 
                               th:value="${user.password}" 
                               readonly
                               style="pointer-events: none;" 
                               class="bg-customLightGray text-white p-1 rounded w-40" />
                    </p>
            
                    <!-- Edit Button -->
                    <div class="flex items-center">
                        <button type="button" id="editButton" 
                                onclick="toggleEditMode()" 
                                class="bg-customPink px-4 py-1 rounded-full text-white hover:scale-105 transition-transform">
                            Edit
                        </button>
                    </div>
                </div>
            </form>
            

            <!-- User's Media Lists -->
            <h2 class="text-2xl font-bold mb-4 text-customPink">Your Lists</h2>
            <div th:each="list : ${user.mediaLists}" class="mb-8">
                <h3 class="text-base mb-4 text-white" th:text="${list.name}"></h3>
                <div class="overflow-x-auto scrollable-div">
                    <div class="flex gap-6">
                        <div th:each="media : ${list.mediaList}" class="flex flex-col items-center w-36">
                            <a th:href="@{/media/{id}(id=${media.id})}">
                                <img th:src="@{${media.posterURL}}" alt="Poster of ${media.title}" class="w-36 h-48 object-cover rounded-lg shadow-md mb-2" />
                            </a>
                            <a th:href="@{/media/{id}(id=${media.id})}" 
                            th:text="${media.title}" 
                            class="movie-title text-center block text-white mb-2 transition-colors duration-300 ease-in-out hover:!text-customPink">
                                Movie Title
                            </a>
                        </div>
                    </div>
                </div>                
            </div>

            <!-- Ratings Section -->
            <h2 class="text-2xl font-bold mb-4 text-customPink">Your Ratings</h2>
            <ul class="space-y-4">
                <li th:each="rating : ${ratings}" class="bg-gray-800 p-4 rounded-lg shadow-lg">
                    <p>
                        <strong class="text-customPink">Media:</strong>
                        <a th:href="@{/media/{id}(id=${rating.media.id})}" th:text="${rating.media.title}" class="hover:underline text-customPink"></a>
                    </p>
                    <p>
                        <strong class="text-customPink">Rating:</strong>
                        <span th:text="${rating.rating}"></span>/5
                    </p>
                    <p>
                        <strong class="text-customPink">Comment:</strong>
                        <span th:text="${rating.comment}"></span>
                    </p>
                    <p class="text-sm text-gray-400">
                        <strong class="text-customPink">Posted on:</strong>
                        <span th:text="${rating.date}"></span>
                    </p>
                </li>
            </ul>

        </div>

        <!-- Scrollable-Div Script -->
        <script src="/assets/js/scrollable-div.js"></script>     

    </div>

    <!-- Footer -->
    <div th:replace="~{Components/Footer :: footer}"></div>
</body>
</html>
